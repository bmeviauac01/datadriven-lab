name: Build Docker images for AHK

on:
  push:
    paths:
      - "ahk/**"
      - ".github/workflows/**"

jobs:
  build:
    runs-on: ubuntu-18.04

    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1

      - name: Build and push Docker images
        working-directory: ./ahk
        env:
          DOCKER_REG_USERNAME: ${{ secrets.DOCKER_REG_USERNAME }}
          DOCKER_REG_TOKEN: ${{ secrets.DOCKER_REG_TOKEN }}
        run: |
          docker login -u $DOCKER_REG_USERNAME -p $DOCKER_REG_TOKEN
          docker-compose build
          docker-compose push
          docker logout
